// Obfuscate using obfuscator.io

var highlighted = -1;
function make_click_handler(cell) {
    return function() {
        // console.log(cell);
        highlight(cell);
    };
}

var cells = [];

function unhighlight_cell(cell) {
    if (cell < 0 || cell >= cells.length) return; 

    cells[cell].removeClass('dropquote-highlight');
    cells[cell].addClass('dropquote-empty');
}

function highlight_cell(cell) {
    if (cell < 0 || cell >= cells.length) return; 

    cells[cell].removeClass('dropquote-empty');
    cells[cell].addClass('dropquote-highlight');
}

function highlight(cell) {
    if (cell < 0 || cell >= cells.length) return;
    unhighlight_cell(highlighted);
    highlighted = cell;
    highlight_cell(highlighted);
}

function get_freqs(word) {
    var freqs = Array(26).fill(0);
    for (var i = 0; i<word.length; i++) {
        var diff = word[i].charCodeAt() - 65;
        freqs[diff]++;
    }
    return freqs;
}

function freqs_to_string(freqs) {
    var ans = "";
    for (var i=0;i<26;i++) {
        for (var j=0;j<freqs[i];j++) ans += String.fromCharCode(65+ i);
    }
    return ans;
}

function parse_bucket(bucket, col, num_rows, num_cols) {
    var bucket_freqs = get_freqs(bucket);
    
    var savedstr = "";
    for (var i = col;i<textlen;i+=num_cols) savedstr += saved[i];
    var saved_freqs = get_freqs(savedstr);

    return diff_buckets(bucket_freqs, saved_freqs);
}

function diff_buckets(bucket1, bucket2) {
    var remainder = Array(26).fill(0);
    var subtracted = Array(26).fill(0);
    var bad = false;
    for (var i=0;i<26;i++) {
        if (bucket2[i] > bucket1[i]) {
            subtracted[i] = bucket1[i];
            remainder[i] = 0;
            bad = true;
        } else {
            subtracted[i] = bucket2[i];
            remainder[i] = bucket1[i] - bucket2[i];
        }
    }

    return {
        'unused': freqs_to_string(remainder),
        'used': freqs_to_string(subtracted),
        'bad': bad
    };
}

var cur_rows = 0;
var cur_cols = 0;

function build_dropquote(dq) {
    var buckets = dq.buckets;
    var grid = dq.grid;

    var num_cols = buckets.length;
    var num_rows = grid.length;

    cur_rows = num_rows;
    cur_cols = num_cols;

    var dropquote = $("<table/>").addClass("dropquote");
    var bucketRow = $("<tr/>").addClass("dropquote");

    for (var col=0;col<num_cols;col++) {
        var cell = $("<td/>").addClass("dropquote");

        var bucketData = parse_bucket(buckets[col], col, num_rows, num_cols);
        
        cell.append($("<div/>").addClass("dropquote-bucket").text(bucketData.unused));
        
        cell.append($("<div/>").addClass("dropquote-bucket").addClass("used").text(bucketData.used));

        if (bucketData.bad) {
            cell.addClass("bucket-bad");
        }

        bucketRow.append(cell);
        
    }
    // console.log(parse_bucket(dq.buckets[0], 0, num_cols, num_rows));
    dropquote.append(bucketRow);

    cells = [];

    for (var row=0;row<num_rows;row++) {
        var dqRow = $("<tr/>").addClass("dropquote");
        for (var col=0;col<num_cols;col++) {
            var cell = null;
            var cellnum = row*num_cols + col;
            if (grid[row][col] == '.') {
                cell = $("<td/>").addClass("dropquote").addClass("dropquote-solid");
            } else {
                cell = $("<td/>").addClass("dropquote").addClass("dropquote-empty");
            }

            cell.click(make_click_handler(cellnum));
            var filler = $("<div/>").addClass("dropquote-filler");
            if (grid[row][col] != '.') {
                filler.text(saved[cellnum]);
            }
            cell.append(filler);
            dqRow.append(cell);
            cells.push(cell);
        }
        dropquote.append(dqRow);
    }
    
    $("#puzzle").empty();
    $("#puzzle").append(dropquote);

    highlight(highlighted);
}

const textlen = 451;
var saved = [];
for (var i=0;i<textlen;i++) saved.push(' ');

var gridcheck = "???????.?????????.?????.?????????.?????.???????.???????.?????.???????????.???????.???????.???????????.?????.?????????.?????.?????????.???????.?????????.???????.???????.???????.?????.?????.?????.?????.?????.???????.?????????.???????.???????.???????.?????????.???????.?????.?????????.?????.?????.?????????.?????.???????????.?????????.???????.???????.?????.???????.?????.???????.?????.???????????.???????.?????.???????.?????.?????????.???????.?????.?????.................";
var dropquotes = [{"buckets": ["AAAAAABBBCDDEEEGHIIIIIKLLNNOPRRRRRSSSTTTTTTVYY", "BCDDEEEEEEEGHHLLLMNNOOORRTTVV", "AAAAAAABCCDDDEEEEGGHIIKMNNNNNOOOPRRRSSTTUUVWZ", "AAADEEEEEFIIIIIILNNNOOOOOPRRRSTUY", "AABCCCDEEEEEGHIIMMNNNOPPRRSSSSSSTTTTTUUUUVWXZ", "AADEEEEEEEFGGHHIIILNNOOOOOOPRRSSSSSTVX", "ACCDDEEEEFGGHHIIIJLLLMNNNOOOOORRRRRRRSSTTWWWY", "AAAABDDEEEEEEFHIIIIKLLMNOORSSTUW", "ABCCDDDDEEEFGIIJKKLMMNNOOQRRSSSSSSSSSTTTTTVWY", "AAAAAAACCEEEEEEEEEGHHIIOOORRRSTTTTUUY"], "grid": ["???????.??", "???????.??", "???.??????", "???.?????.", "???????.??", "?????.????", "?.????????", "???.??????", "?.???????.", "??????????", "?.?????.??", "???????.??", "???.??????", "???.??????", "?.????????", "?.???????.", "???????.??", "?????.????", "?.?????.??", "???.?????.", "?????.????", "???.??????", "???.??????", "?.???????.", "???????.??", "???????.??", "?????.????", "?.????????", "?.?????.??", "???.??????", "???.?????.", "??????????", "?.????????", "?.???????.", "???????.??", "???.??????", "?.?????.??", "?????.????", "?.????????", "???.??????", "?.?????.??", "?????.????", "?.????????", "?.???????.", "?????.????", "?........."]}, {"buckets": ["AAABBCDEEEFGHHIMNNOOOOOOPRSSTTTUUWYY", "ADEEEEEEEGGIIJLLNOQRRSSSSSTTTUZ", "AAAAAACDDDEEEEEFHHIIIMMNNNORRSSTTUWW", "ABDDEEEEEEEEIIIKNOOOOOOPRSSTTTTVVVVWXY", "AAABCCCDEEEEEEEEIIINNNOORRRSSSSTTTVXY", "ADDDEEEEFFGGHHIILNNOPRRRRRRRRSSSTTTU", "AACDDEEEEEEEIIIIJKLNNOOOORRSSSSTTU", "AAABBCCDEEEHIKLLMNOPRRRRSSSSTTTUVV", "AAAAAAABCDDDEEGGHIIIIIIILLNORSSSSUYZ", "AAABCCCDEEEGHHIIKLLLLMMNNNNOOOPRRSTUWW", "AAACEEEFGGGHHIKLMMNNNOOOOOPRRRRTTTTTUWY"], "grid": ["???????.???", "??????.????", "?.?????????", ".?????.????", "???.???????", ".?????.????", "???????.???", "????.??????", "?.?????????", "??.?????.??", "???????.???", "??.????????", "?.???????.?", "????????.??", "?????.?????", "??.???????.", "?????.?????", ".?????.????", "?.?????.???", "????.??????", "???.???????", ".???????.??", "?????.?????", "????.??????", "?.?????.???", "??????.????", "?.?????.???", "??????.????", "?.?????????", "??.????????", "?.???????.?", "??????.????", "?.???????.?", "????.??????", "?.?????.???", "????????.??", "?????.?????", ".???????.??", "???.???????", "??.???????.", "?????.?????"]}, {"buckets": ["AACDDEEEGHHIIILLMNNOPRRRRRSSSSTTTUVWWX", "AADDEEEEEHIIIILLMMNOOOOORSTY", "AAAAABCCDDDDEEEFIIIKLLNNNNOPRRSSSTTUVW", "AAADEEEEEFFGIIIINNOOOORSSSSSTTU", "AABCCCEEGGHILMMNNOOPRRRRRSSSSTTTTTTTVZ", "ACCDEEEEEEEEHHHHIIKLNOOOOPRRTY", "AAABDDEEEEGHIKLMNNNOPQRRRRRSSSSTTTTYYY", "AAAABCEEEEEGGINNORSTTUWX", "AAABCCDDEEEEFGGIIIJJKNNOOSSSSTTTTUWYZ", "AAABEEEEEEGHLLNOOORRRRRSTTUV", "AABBCCDDEEEGHIIIKMMNNOOOOORRSSSUUUVWW", "AAADDEEEEEFHIIIILLNOOPRSTUVV"], "grid": ["???????.????", "?????.?????.", "?????????.??", "???.???????.", "???????.????", "?.??????????", "?.???????.??", "?????.??????", "?????.?????.", "?????????.??", "???.????????", "?.???????.??", "???????.????", "???.???????.", "???????.????", "?.?????.????", "?.?????.????", "?.???????.??", "???????.????", "???.???????.", "???????.????", "?????.??????", "?.?????.????", "?????.?????.", "?????.??????", "???.?????.??", "?????????.??", "???????.????", "???.???????.", "?????.??????", "?.?????.????", "???.?????.??", "?????????.??", "?????.?????.", "???????.????", "?.?????????.", "???????.????", "?.?????....."]}, {"buckets": ["AAAABBDDEEGIIIIKLLMNNOPPQRRSSWWY", "ABCDDDDDDEEEEEEEIJLLNOOOSSTTTTTUZ", "ADEEEEEEEGGGHHIKMMNNOOORRRSSTTXY", "AAAEEEEEGHHIIINNOORRRRSSSTU", "AAACCCDDEIJLMMORRRRSSSSTTTTVXY", "AAABCEEHIIIIIMNNOOOOPPRRTUUUUY", "AAAAAAABCCDEGGIKLNNOOOPRSSSSTTUV", "CCDEEFFGHHHHIILNNNOORRSTTTTTTUVV", "ACEEEEEEEFIIILLNNOOOORRSSSTTTUY", "BCCDEEEEEEEEFGGHILLNNNNORSSTVWY", "AAACDEEEFGHIIIKRRRRSSSTVVW", "AAABDDEEEIIINOOOPRRTTTUWWWZ", "AAAABDEEEEEHIKLLMMNNOOOORRRSSSSS"], "grid": ["???????.?????", "????.?????.??", "???????.?????", ".???????.????", "???.?????.???", "????????.????", "???.???????.?", "??????????.??", "???.?????????", ".?????.??????", "???.???????.?", "????????.????", "???.???????.?", "??????.?????.", "?????.?????.?", "????.?????.??", "?????.???????", "??.???????.??", "?????.???????", ".?????????.??", "?????.?????.?", "????????.????", "?.?????.?????", "????.?????.??", "?????????.???", "??????.??????", "?.???????.???", "??.???????.??", "???.???????.?", "????.????????", "???.???????.?", "????.???????.", "?????.???????", "??.???????.??", "???.?????...."]}, {"buckets": ["ADDDEEEGHIJLLNOOOPPRRRSSSSTTTTUVY", "DEEEEEGGIIIIKLLOOOOORRSSTY", "AACCDDEEGGIIIKMNNNRRSSSSSSSTTUUYY", "AAABDEEEEFFGHIIINNOORST", "AAAABBBDEEEGHINNNNOPRSSSTTTTTUUV", "AAADEEEHILNNNOPRRTUVXY", "AAABCCCEEEFHIIIILMNOORRRSSSSTTTW", "AAABCDEEEHIIIILLNOOOOORSSTW", "AABCCCDDEFGKKLMMMNNOOOQRRRSTUWYZ", "ACEEEEEEEEHHMNOOPRRRSTUV", "AABCDDDDEEEEGHJKLNNOOPRSSTTTWWWX", "AAAACDEEEEEEHILMOSTTUV", "AAACEEEGHIIIIILMNNORRRRRRSTTVVWZ", "AADEEEEEFGHIILNOOORRSSTTU"], "grid": ["???????.??????", "???.?????.????", "?????.?????.??", "?????.???????.", "?????.????????", "???.???????.??", "?????.????????", "???.?????.????", "?????.?????.??", "???????.??????", "?.?????????.??", "?????.???????.", "???????.?????.", "?????.?????.??", "???.?????.????", "???.?????????.", "???????.??????", "?.???????.????", "?????.???????.", "?????.????????", "?.?????.?????.", "?????????.????", "?.???????????.", "?????????.????", "???.???????.??", "???.???????.??", "???.???????.??", "???.??????????", "?.???????.????", "?.???????.????", "?.?????????.??", "?????.?????.??", "???..........."]}, {"buckets": ["AADEEEGGHIIILOOPRRRRRSSSSSTTYY", "BCCEEEEEEHHLMMNORRRRSTW", "AAAAABCCDDEEGHIKNORSTW", "BCDDEFILLMNNNOOQRRRSSSTTV", "AAAACCCEEEGGHIIMNOOOPSTUUUVY", "AAAAACDEEEEEEFHHIKLNNNNOOPSTVV", "AEEEEGGILNNNOOOORRRTTTVWY", "AADDEEGIILMMNNNOOORSTTUVWZ", "ADDEEEEFIIIIIIJKOOPSSSTTUYY", "AAAADEEEEHHMRRRSSSSTTTTUWX", "ABBBDEGIIIILOOORRSSTTTTX", "CDDDDEFGHHIIJLLLLNOOORRSVW", "AAAABDEEEEEEFHIIIKLNNOPRRSSUU", "AAACDEEEGIKMNNOOORRSSSSTTW", "ABCCEEEEEEEIINNOPRRSSTTTTUUZ"], "grid": ["???????.???????", "??.?????.??????", "???.?????.?????", "??.???????.????", "?.???????????.?", "??????.???????.", "???????????.???", "??.?????????.??", "???.?????????.?", "??????.????????", "?.???????.?????", "??.???????.????", "?.?????.?????.?", "????.?????.????", "???.?????????.?", "??????.???????.", "???????.???????", "??.???????.????", "?.?????????.???", "??.?????.??????", "???.?????.?????", "??????.????????", "?.???????.?????", "??.?????.??????", "?.?????.???????", ".?????.????????", "???.???????.???", "??.???????.????", "?.?????????.???", "????.?????.????", "?.............."]}, {"buckets": ["AACEEEEFGHIMMMNOPPRSSSSSTTTTW", "AAAACEEHLLOOOOPRRSTTU", "AAAAABBBCDEGIKLNOPRSSSTTTTVWY", "AAAAADEEEEEEHIIIILNNRSSTTTX", "ACDEEGIIKLNOORRRRRSSSSTTUWYZ", "CEEEEEEHIIKLLMNOOOOT", "ACDEEHIIIINNNNOOOOPRRRSSSSTU", "AEFFGIINNOORRSTU", "AACCDGGGHIIIJJLLNRSSTTTTTTWZ", "ABDEEEEEHHHHIMNOORRSVY", "AAABCDDDEEIKKLMNNORRRSSTUVWY", "AAABDDEEEEGIIILOOOOSSTW", "AABBCCDDEEEHINNNOORRRSTTUVVX", "ADDEEEEEEGIIILNOORRRRTY", "ACDDDEEEEEFGHILMMNNOQRRSUUWY", "ACEEEEFGNOPSSUUVV"], "grid": ["???????.????????", "?.?????.????????", "?.?????.???????.", "???????.?????.??", "?????????.??????", "?.???????.??????", "?????.?????.????", "?????.?????.????", "?????.???????.??", "???????.???????.", "???????.???????.", "?????.?????.????", "?.?????.?????.??", "?????.?????????.", "???????.???????.", "???????.????????", "?.???????.?????.", "?????????.?????.", "?????.?????????.", "?????.??????????", "?.?????????.????", "???.???????.????", "?.???????.?????.", "???????.?????.??", "?????????.??????", "?.?????.???????.", "?????.?????????.", "???????.?????.??", "???............."]}, {"buckets": ["ACDDEEIIILLLNOPPRRRRSSSST", "BDEEEEEEGGHHILOORRSSTTTU", "ACDEEFHIIILMNNSSTTTVWWXY", "AAACCEEEEEHLNOOOOORSTTTTY", "AAAADDDEIMMMNNOORRRRTV", "AADEEEEEGIJKMNNNORTUVW", "ABBDEEEEFGIIIIMOORRSTTT", "AAABDEEFGGHIKOOOSSSSTWY", "ABCDDEEEEINOORRRSSTTUUVWWY", "AAAEEEGHLNNOOPPRRRSTTTY", "AAACDEGHIIJKLNNQRSUUV", "AABCDDEEEEGIIKNNNOORSSTUZ", "AAEEEEFHIIIILLLNNORRRSSTU", "ABCCCEEEIIILMNNORRSSTZ", "AAACDEEEEGHHKLNOPSTTVW", "ACDDEEFGHHIIOOOOPSSSUX", "AABCEIMNOORRRSSSTTUVY"], "grid": ["???????.?????????", ".?????.?????????.", "?????.???????.???", "????.?????.??????", "?????.???????.???", "????.???????????.", "?????.?????????.?", "????.?????????.??", "?????.?????????.?", "??????.???????.??", "?????.?????.?????", ".?????.?????.????", "?.???????.???????", "??.???????.??????", "?.???????.???????", "??.???????.?????.", "?????????.?????.?", "????.?????????.??", "???.???????????.?", "????????.???????.", "???????.?????.???", "????.?????.??????", "?.?????.?????????", "??.???????.?????.", "???????.?????.???", "??????.???????.??", "???.?????........"]}, {"buckets": ["AAABDDDEEGHLLMNNPRRRSSSTWY", "AABEEEGIIIINOORSTT", "AAABBCDEEFIJKNNOPSTTTUWWY", "AAAAAEEEGIILNNOOORRSTV", "AABBCEEGGIKNNOOORRRRRRSTU", "CDEEHHHIILLNOOPRRV", "DEEEEHHIIKNQRRRSSSTTTVWYY", "AAAADEGMOOOTUY", "AACCCDEEGIIKLLNNSSSSTTTUZ", "BDEEEEEFGHNOOOORRSSSTTU", "AABCCDEEEHIMMNNOOOSSTTTTU", "AADDEEEEFHIIOOPRSUVY", "AACEGIILMNNOOPRRRRSSTTTUX", "CDEEEEEEHILLMNNORSWX", "AAADDDDEEEFGIIIJNNOORRSSV", "AEEEFIILRRSSTU", "CCDGHIILMMOPRSSSSTTUVVWWZ", "AACEEEEEEEHIIKLNOOTT"], "grid": ["???????.?????????.", "?????.?????????.??", "???.???????.??????", "?.?????.??????????", "?.???????.???????.", "???????????.?????.", "?????????.?????.??", "???????.???????.??", "???????.???????.??", "?????.???????.????", "?.?????.?????.????", "?.?????.???????.??", "???????.???????.??", "?????.???????.????", "?????.???????.????", "?.?????????.?????.", "?????.?????????.??", "???.???????????.??", "???????.???????.??", "?????.?????.??????", "?.?????.???????.??", "???.???????????.??", "?????.?????.??????", "?.?????.?????????.", "???????.?????.????", "?................."]}, {"buckets": ["ACDDEEEEGIIOOOOPPRSSV", "AACCEEEIIJKNNOORRSTVWW", "AACEEEINNOOOQRRSTTUUY", "CDEEHIIKMMNNOOPRSTTU", "AAAADDEEHHLNNORRSSYZ", "ACDDEFFHIILNOOSTUWYZ", "AAEEEEGILLNOOOORSTTTUV", "AAEGIKLLMMNOOPRSSTUWXY", "ACDEEHIILPRRRSSSSTU", "BCDEEEEEHHIKLMORRRRTW", "AAAAACDEEEEGIORRSSSTUV", "BDEEFGHIIMMNNRSSSTTUVV", "AAABCDDEEFGIIILNNORSTTT", "DEEEEEGGIIIKNORRSSTXY", "AAAAACDEEGHIILNOORTT", "AABCDEEHLNOORSSSTTTT", "BBCDEEEEGINOPRRSSSU", "BDEEHIIILNORRSTTTWWY", "AAABEEEFGHJLMNNNORTV"], "grid": ["???????.?????????.?", "????.?????????.????", "?.???????.???????.?", "????.???????????.??", "?????.???????.?????", "??????.?????.??????", "???.?????.?????????", ".???????.?????????.", "???????.???????.???", "????.?????.?????.??", "???.?????.?????.???", "????.?????????.????", "???.???????.???????", ".?????????.???????.", "?????.?????????.???", "??.?????.?????????.", "?????.???????????.?", "????????.???????.??", "?????.?????.???????", ".?????.???????.????", "?.???????????.?????", "??.?????.???????.??", "???.?????????.?????", "??.?????.?????....."]}, {"buckets": ["AABCEEEGIKLPRRRRSSSTTTT", "CEEEHHLMNOTV", "AAAAACDEEKMNNOOPRRSSUVW", "AAAEFIIIIINNOOOPRTU", "ADGHIIMNNOPRSTTTTTUVWXZ", "ADEEEEEGHILNOOOOPRRS", "DDEGHIILMNNOOORRRRRTTWY", "AADEEFINSSTUW", "ACCDEIJMMORRSSSSSSTTTVY", "AAACEEEHHIOOORRRTTTUY", "AAAABBDDHIIIILNNORTTVYY", "BDDEEEEGLLNOORRTV", "AABCDDEEGGHIINNNORTTUZ", "DEEEEILNOORRSY", "ABCCCEEEEEMNPRSSSSSUUU", "AEEFGHIINOOSSSSTVX", "ACCEEEFGHIJLLNOORRSSWW", "AABDEEEEHIIIKLLMOOR", "BDDDEEFGIKKLNNOQSSSTTW", "AAAACEEEEEEGISTU"], "grid": ["???????.?????????.??", "???.?????????.?????.", "???????.???????.????", "?.???????????.??????", "?.???????.??????????", "?.?????.?????????.??", "???.?????????.??????", "?.?????????.???????.", "???????.???????.????", "?.?????.?????.?????.", "?????.???????.??????", "???.???????.???????.", "???????.?????????.??", "?????.?????.????????", "?.?????.?????.??????", "???.?????.??????????", "?.?????????.???????.", "???????.?????.??????", "?.?????.???????.????", "?.???????????.??????", "?.?????.???????.????", "?.?????????.???????.", "?????.?????........."]}, {"buckets": ["ADEEGHLLNOOOPRRRSSSTT", "CCDEEEGGLLMMNOOOORRYZ", "ACDDEEEEGHINNPTTUUV", "ABDEEFFGHKLNNOOSSWX", "AABCEEHIMNOSTTTTUU", "AACEEEHIILNNNPRSWYZ", "ACDEEGHILMOORRRSTTTTU", "AABEEHIILNOOOSSTUVW", "ABCDFIKKKLOOORRSSTT", "AAEEEHINORRRRSSSSSSYY", "ABCDDEEEGIINOPRTTW", "AAABDEEEEGHLNOSSUVV", "AAEEEIILNRRRRTTUVV", "AAABEEINORRSSSSTW", "ACDDDEEIIIJLOOPRSTTY", "ADEEEGIIIMNOQRSUWY", "CCEEEGIKMMNORSSTU", "AAADDEEEHIJNORSTTW", "AAABDEEEINNPRSTTT", "AADGHIIMNOORRRTVX", "ACCEEEEFFHIIIILNOOS"], "grid": ["???????.?????????.???", "??.?????????.?????.??", "?????.???????.?????.?", "??????????.???????.??", "?????.???????????.???", "??.?????????.?????.??", "???????.???????.?????", "????.???????.???????.", "???????.?????.?????.?", "????.?????.?????.????", "???.?????????.???????", ".???????.???????.????", "?????.???????.?????.?", "????????.?????.?????.", "?????????.?????.?????", "??????.?????????.????", "???.???????.?????.???", "????.?????.???????.??", "???.???????????.?????", "??.?????.???????.????", "?.?????????.???????.?", "????.?????..........."]}, {"buckets": ["AABEFGINNOPSSTTTUUWYY", "EEEGGILNSST", "AAAACDDEFHHIIIMNNRTWW", "BDEEEEEINOOOOORTVX", "AABCCCDEIINNNOORRSTTX", "DDEEFFGHHILNORRT", "ADDEEEEEJKLNOOORSSSTT", "AAACEEILRRSTUV", "AAABCDDEGGIIILRSSSSUZ", "AAEEEGHHILLNNOOPTW", "ACGGGHHMMNNNOORRTTTWY", "ABCDEEHHMOOOOOR", "ADEEEEIJLOQRRSSSTTUZ", "AADEEEEMNORSSTU", "ADEEEIIKOPSSTTTVVVWY", "AEEEEEEEIRSSSTVY", "ADEEGINPRRRRRRSSSTTU", "ACEEIIIINORSU", "BBCDEHKLMNOPRRSSSTTV", "AAAADEHIIIILNOY", "ABCCCDIKLLMMNNORRSUW", "AAEEEFIKLOOOPRRTTU"], "grid": ["???????.?????????.????", "?.?????????.?????.????", "???.???????.?????.????", "???????.???????.??????", "?.???????????.?????.??", "???????.?????.????????", "?.???????.?????????.??", "?????.???????.???????.", "?????.?????.?????.????", "?.?????.???????.??????", "???.???????.???????.??", "?????.?????????.??????", "?.?????.?????????.????", "?.?????.?????????.????", "?.???????????.????????", "?.???????.???????.????", "?.???????.?????.??????", "?.?????.???????????.??", "?????.?????.???????.??", "???.?????????.???????.", "?????.?????..........."]}, {"buckets": ["ABCEEEEEEGHILNOPSTV", "ADEEHIIMMNRRSTUUW", "ABCEEINNOOOSSTWZ", "ACDEEHIINNNNRSSTVV", "AAADEEGIIMNOOSSTU", "AABDDEEEGLNNNPRRTTT", "AAAAEEEGIMORRSSTTT", "AEEFIIKRRRRRSTUVX", "AEEEHINNNORSSSTYY", "AAEEFGHLNOQRRVY", "ADEIJOPRSSTTUUUWX", "CDEEEGGIIKKNOORSSTT", "AAAEEEHIIKLLMNRRTY", "ABDEFIKMNOOSTTWWYZ", "ACDEEIIILMOOORSTTU", "BCDEEFLLOOPRRRST", "ACDDDEEHLLNOSSU", "CDEIIOORSTTVWW", "AAABEEEEFHJLMOORT", "AAACDEGGHINOPRRSSTV", "ACCDDEEEGILNOOOPT", "AABCCEEILOORSSSUY", "BDEGHHHIIINORRSST"], "grid": ["???????.?????????.?????", ".?????????.?????.??????", "?.???????.?????.???????", "????.???????.???????.??", "?????????.?????.???????", "??.?????.?????????.????", "???.?????????.???????.?", "??????.???????.?????.??", "???.?????.?????.?????.?", "??????.?????????.??????", "?.???????.???????.?????", "????.???????.?????.????", "?????.?????.?????.?????", "????.?????.???????????.", "?????????.???????.?????", "??.?????.???????.?????.", "???????.?????.?????????", "??.???????.?????.??????", "?.?????.?????????.?????", "??.?????.?????........."]}, {"buckets": ["ACEGHIILLMNOPRSSTTW", "ADEEHILMOOORSTY", "AAABDDEIKLNNNPSTTVW", "AAADEEIIINOORSSTT", "ABCCEGILNOORRRRSTTV", "CDEEEEEHIIKLNOORY", "DEEEEGHIMNNNPQRRSTY", "ACEEGNRU", "AACDEEFGGIIJJSSTTTW", "AAABEEHLNORRSUV", "AABBCCDEEGIKMORSUVW", "AADDEEEEEHIIILLOS", "ADDEEHINRRRRSSTUVWX", "ADEEEIIILMNOO", "AACCDDEEFIILNORRSSU", "EEEFFGINOOSSSU", "ACEGHMMNPRSSSTTTTTZ", "ACEEEHHHOOPRT", "AAABDKLORRRSSSTTTYY", "AAABEEEGINOSTTWX", "ABCDEEIKNNOOSSTUYZ", "EEEEGLOORRRTT", "DEHIIMNNOOOORSSUUW", "AFINOPRTUVV"], "grid": ["???????.?????????.?????.", "?????????.?????.???????.", "???????.?????.??????????", "?.???????.???????.??????", "?????.?????.?????????.??", "???.?????????.???????.??", "???????.???????.???????.", "???????.?????.?????.????", "?.?????.?????.???????.??", "???????.???????.???????.", "???????.?????????.??????", "?.?????.?????????.?????.", "?????.?????????.?????.??", "?????????.?????????.????", "???.???????.?????.??????", "?.?????.???????.?????.??", "?????????.???????.?????.", "???????.?????.?????????.", "???????.?????.?????....."]}, {"buckets": ["AAAEEHHIILOPRRSTY", "EEEEEFGHLNORRRV", "ACDEEEGHKMNNOOPRTW", "AADEEIINOOQRRSTW", "AAADEGIOPRRRRSUUUZ", "ABDEEINNORSSSTXY", "ADEJLMNOORT", "AADEEGLOSSTTUZ", "DEEEIIIKMOPRSSTY", "ACEEGHHINNOPRSST", "AAEEFHIIKLLOORSTTV", "CCDEEEEGILORRTWW", "ACDEFHIIILNORRSW", "DDDILMNNNOOOSSTTU", "EEEEEMNOOSTTU", "AADEEINOPRSSSTTT", "BCDEHHLNORSSTTVWY", "AABDDEEEIIMORS", "AABCEGIKNORSSST", "AACCEEEEIISTTTUUXY", "BBCDEEGGGIINOORRV", "DGHIILLMNNOOORR", "AAAAABEIKNNNUUV", "CEEFFIJLRSSTVY", "AAABCCEEHMSSTTTVW"], "grid": ["???????.?????????.?????.?", "????????.?????.???????.??", "?????.?????.???????????.?", "??????.???????.??????????", "?.?????.?????????.?????.?", "????????.???????.????????", "?.???????.???????.???????", ".?????.?????.?????.?????.", "?????.???????.?????????.?", "??????.???????.???????.??", "???????.???????.?????.???", "??????.?????.?????.??????", "???.?????.???????????.???", "??????.???????.???????.??", "???.???????.?????.???????", ".?????.???????????.??????", "?.?????.???????.?????.???", "??????.???????.?????.????", "?........................"]}, {"buckets": ["ABDDGIIKMNOPQRSSWW", "ADDDDEEEEEILOSTU", "DEEEEEEGGMMNORTTXY", "EEHHNORRSU", "AACCCDDEIJRRSSSTTT", "ACEIINNOOOTUU", "AAABCDGKNNORSSSTTU", "CDEEFGHIILNNTTT", "ACEEFILLNNORRSSTUY", "EEEEEEEFGHIOTV", "AACDEGIKRRRSSTVVW", "AABDEEIOOW", "AABDEHIKLMMNOSSSS", "AAABEEIILLNPRY", "BCDDEEJLNOOSTTTTZ", "AEGHHIKNOORRSS", "AAAEEEGIIINORRSST", "ALMMORRSTVXY", "AABEHIIIMOPPRRUUY", "AAAACEGILOOPSV", "CFHHHNOORRSTTTUVV", "EEEEEIIOOOSTT", "BCCDEGLLNNNNRSSWY", "AEEFHIIRS", "ADEIINOPRRTTTUWWZ", "AAEEEELNOOORRRS"], "grid": ["???????.?????????.?????.??", "???????.?????.???????.????", "???.?????.???????????.????", "???.???????.???????????.??", "???.?????????.?????.??????", "???.???????.?????????.????", "???.???????.???????.?????.", "?????.?????.?????.?????.??", "?????.?????????.???????.??", "?????.???????.?????????.??", "?????.?????.?????????.????", "?.?????.?????????.?????.??", "?????????.?????????.??????", "?.???????.?????.???????.??", "???.???????.?????.????????", "???.???????.?????.???????.", "?????.?????????.???????.??", "???.?????................."]}];

var MIN_COLS = 10;
var MAX_COLS = 25;

function update() {
    var width = $(window).width();
    var num_cols = Math.floor((width-80)/40);

    if (num_cols < MIN_COLS) num_cols = MIN_COLS;
    if (num_cols > MAX_COLS) num_cols = MAX_COLS;

    build_dropquote(dropquotes[num_cols-MIN_COLS]);
}

$(window).resize(update);
$(document).ready(update);

$(document).keydown(function(event){
    if(event.ctrlKey) return;

    if (highlighted < 0 || highlighted >= textlen) return;

    var keyCode = event.which;

    if(keyCode>=65 && keyCode<=90){
        if (gridcheck[highlighted] == '.') return;
        saved[highlighted] = String.fromCharCode(keyCode);
        update();
        // highlight(highlighted+1);
    } else if (keyCode == 46 || keyCode == 8) {
        saved[highlighted] = ' ';
        update();
    } else if (keyCode == 38) {
        event.preventDefault();
        highlight(highlighted-cur_cols);
    } else if (keyCode == 39) {
        event.preventDefault();
        highlight(highlighted + 1);
    } else if (keyCode == 37) {
        event.preventDefault();
        highlight(highlighted - 1);
    } else if (keyCode == 40) {
        event.preventDefault();
        highlight(highlighted + cur_cols);
    }
});